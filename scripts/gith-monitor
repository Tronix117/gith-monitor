#!/usr/bin/env coffee

path = require 'path'
fs = require 'fs'
{Monitor} = require 'forever-monitor'

githMonitorPath = null
GithMonitor = (try require githMonitorPath = path.join realdir, '..', 'index') or (try require githMonitorPath = 'gith-monitor') or (try require gitMonitorPath = '/usr/local/lib/node_modules/gith-monitor')

unless GithMonitor
  console.error 'Can\'t find gith-monitor, make sure you have done `npm install -g gith-monitor`.' 
else
  child = new Monitor('index.coffee',
    max: 3
    pidFile: config.pidfile
    silent: true
    command: 'coffee'
    sourceDir: gitMonitorPath
    options: []
    logFile: config.logfile
    outFile: config.logfile
    errFile: config.logfile
  )

  child.on 'exit', ()-> console.log 'gith-monitor has exited after 3 restarts'

  child[process.argv[2]]()